---
- hosts: all
  vars_files:
    - vars/brewkegs.yml
    - vars/brewcasks.yml
    - vars/brewtaps.yml
    - vars/rubygems.yml
    - vars/filetestruns.yml

  tasks:
    - name: Setup brew taps
      homebrew_tap: "name={{ item.name }} state={{ item.state }}"
      with_items: "{{ brewtaps }}"

    - name: Install kegs with brew
      homebrew:
        name: "{{ item.name }}"
        state: "{{ item.state }}"
      with_items: "{{ brewkegs }}"

    - name: Install apps with brew-cask
      homebrew_cask: "name={{ item.name }} state={{ item.state }}"
      with_items: "{{ brewcasks }}"

    - name: Install Ruby gems
      gem: "name={{ item.name }} state={{ item.state }}"
      with_items: "{{ rubygems }}"

    - name: Shell executions based on file tests
      shell: "{{ item.run }} > {{ item.name}}.log"
      args:
        creates:  "{{ item.creates }}"
      with_items: "{{ filetestruns }}"
